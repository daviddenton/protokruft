package org.protokruft.example2

import io.grpc.Channel
import io.grpc.stub.StreamObserver

interface PersonService {
    fun getAddress(person: Example2.Person): Example2.Address

    object Grpc {
        object Client {
            operator fun invoke(channel: Channel): PersonService {
                val stub = PersonServiceGrpc.newBlockingStub(channel)
                return object : PersonService {
                            override fun getAddress(person: org.protokruft.example2.Example2.Person): org.protokruft.example2.Example2.Address = stub.getAddress(person)
                        }
            }
        }

        class Server(private val delegate: PersonService) : PersonServiceGrpc.PersonServiceImplBase() {
            override fun getAddress(person: Example2.Person, responseObserver: StreamObserver<Example2.Address>) {
                responseObserver.onNext(delegate.getAddress(person))
                responseObserver.onCompleted()
            }
        }
    }
}
